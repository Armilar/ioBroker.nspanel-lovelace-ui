{
  "version": 3,
  "sources": ["../../../src/lib/pages/pagePower.ts"],
  "sourcesContent": ["import { Page, PageInterface } from '../classes/Page';\nimport { White } from '../const/Color';\nimport {\n    deepAssign,\n    getEntryTextOnOff,\n    getIconEntryColor,\n    getIconEntryValue,\n    getPayload,\n    getScaledNumber,\n    getValueEntryNumber,\n    getValueEntryString,\n} from '../const/tools';\nimport * as pages from '../types/pages';\nimport { IncomingEvent } from '../types/types';\n\nconst PagePowerMessageDefault: pages.PagePowerMessage = {\n    event: 'entityUpd',\n    headline: 'Page Grid',\n    navigation: 'button~bSubPrev~~~~~button~bSubNext~~~~',\n    homeValueTop: '',\n    homeIcon: '',\n    homeColor: '',\n    homeName: '',\n    homeValueBot: '',\n    leftTop: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n    leftMiddle: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n    leftBottom: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n    rightTop: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n    rightMiddle: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n    rightBottom: {\n        icon: '',\n        iconColor: '',\n        value: '',\n        speed: 0,\n        name: '',\n    },\n};\n\n/**\n * untested\n */\nexport class PagePower extends Page {\n    items: pages.PageBaseConfig['items'];\n    constructor(config: PageInterface, options: pages.PageBaseConfig) {\n        super(config, options);\n        if (options.config && options.config.card == 'cardPower') this.config = options.config;\n        this.minUpdateInterval = 2000;\n    }\n\n    async init(): Promise<void> {\n        await this.panel.statesControler.setInternalState(\n            `///${this.name}/powerSum`,\n            0,\n            true,\n            { name: '', type: 'string', role: '', read: true, write: false },\n            this.onInternalCommand,\n        );\n        const config = structuredClone(this.config);\n        // search states for mode auto\n        const tempConfig: Partial<pages.cardPowerDataItemOptions> =\n            this.enums || this.dpInit\n                ? await this.panel.statesControler.getDataItemsFromAuto(this.dpInit, config, undefined, this.enums)\n                : config;\n        // create Dataitems\n        //this.log.debug(JSON.stringify(tempConfig));\n        const tempItem: Partial<pages.cardPowerDataItems> = await this.panel.statesControler.createDataItems(\n            tempConfig,\n            this,\n        );\n        this.items = tempItem as pages.cardPowerDataItems;\n        // set card because we lose it\n        this.items.card = 'cardPower';\n        await super.init();\n    }\n\n    onInternalCommand = async (id: string, _state: ioBroker.State | undefined): Promise<ioBroker.StateValue> => {\n        if (!id.startsWith('///' + this.name)) return null;\n        const token = id.split('/').pop();\n        if (token === 'powerSum') {\n            const items = this.items;\n            if (!items || items.card !== 'cardPower') return null;\n            const data = items.data;\n            const l1 = await this.getElementSum(data.leftTop, 0);\n            const l2 = await this.getElementSum(data.leftMiddle, 0);\n            const l3 = await this.getElementSum(data.leftBottom, 0);\n            const r1 = await this.getElementSum(data.rightTop, 0);\n            const r2 = await this.getElementSum(data.rightMiddle, 0);\n            const r3 = await this.getElementSum(data.rightBottom, 0);\n            let sum = l1 + l2 + l3 + r1 + r2 + r3;\n            if (items.data.homeValueBot && items.data.homeValueBot.math) {\n                const f = await items.data.homeValueBot.math.getString();\n                if (f) sum = new Function('l1', 'l2', 'l3', 'r1', 'r2', 'r3', 'Math', f)(l1, l2, l3, r1, r2, r3, Math);\n            }\n            return String(sum);\n        }\n        return null;\n    };\n    public async update(): Promise<void> {\n        if (!this.visibility) return;\n        const message: Partial<pages.PagePowerMessage> = {};\n        const items = this.items;\n        if (!items || items.card !== 'cardPower') return;\n        const data = items.data;\n        message.headline = this.library.getTranslation(\n            (this.items && this.items.data.headline && (await this.items.data.headline.getString())) ?? '',\n        );\n        message.navigation = this.getNavigation();\n\n        message.homeIcon = await getIconEntryValue(data.homeIcon, true, '');\n        message.homeColor = await getIconEntryColor(data.homeIcon, true, White);\n        message.homeValueTop = (await getValueEntryString(data.homeValueTop)) ?? '';\n        message.homeValueBot = (await getValueEntryString(data.homeValueBot)) ?? '';\n\n        // to much work to change types to partial in getMessage we assign a full object to this.\n        message.leftTop = (await this.getElementUpdate(data.leftTop)) as pages.PagePowerMessageItem;\n        message.leftMiddle = (await this.getElementUpdate(data.leftMiddle)) as pages.PagePowerMessageItem;\n        message.leftBottom = (await this.getElementUpdate(data.leftBottom)) as pages.PagePowerMessageItem;\n        message.rightTop = (await this.getElementUpdate(data.rightTop)) as pages.PagePowerMessageItem;\n        message.rightMiddle = (await this.getElementUpdate(data.rightMiddle)) as pages.PagePowerMessageItem;\n        message.rightBottom = (await this.getElementUpdate(data.rightBottom)) as pages.PagePowerMessageItem;\n\n        this.sendToPanel(this.getMessage(message));\n    }\n\n    private async getElementSum(item: pages.cardPowerDataItems['data']['leftBottom'], num: number): Promise<number> {\n        if (item === undefined) return num;\n        const value = await getValueEntryNumber(item.value);\n        return value !== null ? value + num : num;\n    }\n\n    private async getElementUpdate(\n        item: pages.cardPowerDataItems['data']['leftBottom'],\n    ): Promise<undefined | Partial<pages.PagePowerMessageItem>> {\n        if (item === undefined) return undefined;\n\n        const message: Partial<pages.PagePowerMessageItem> = {};\n\n        const value = await getValueEntryNumber(item.value);\n        if (value === null) return undefined;\n\n        message.icon = (await getIconEntryValue(item.icon, value >= 0, '')) ?? undefined;\n        message.iconColor = (await getIconEntryColor(item.icon, value, White)) ?? undefined;\n        message.name = (await getEntryTextOnOff(item.text, value >= 0)) ?? undefined;\n        message.speed = (await getScaledNumber(item.speed)) ?? undefined;\n        message.value = (await getValueEntryString(item.value, value)) ?? undefined;\n\n        return message;\n    }\n    private getMessage(message: Partial<pages.PagePowerMessage>): string {\n        let result: pages.PagePowerMessage = PagePowerMessageDefault;\n        result = deepAssign(result, message) as pages.PagePowerMessage;\n        return getPayload(\n            'entityUpd',\n            result.headline,\n            result.navigation,\n            '',\n            '',\n            result.homeIcon,\n            result.homeColor,\n            result.homeName,\n            result.homeValueBot,\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            result.homeValueTop,\n            '',\n            this.getMessageItem(result.leftTop),\n            this.getMessageItem(result.leftMiddle),\n            this.getMessageItem(result.leftBottom),\n            this.getMessageItem(result.rightTop),\n            this.getMessageItem(result.rightMiddle),\n            this.getMessageItem(result.rightBottom),\n        );\n    }\n\n    private getMessageItem(i: pages.PagePowerMessageItem | undefined): string {\n        if (!i) return getPayload('', '', '', '', '', '', '');\n        return getPayload('', '', i.icon ?? '', i.iconColor ?? '', i.name ?? '', i.value ?? '', String(i.speed ?? ''));\n    }\n    protected async onStateTrigger(): Promise<void> {\n        await this.update();\n    }\n    async onButtonEvent(_event: IncomingEvent): Promise<void> {\n        //if (event.page && event.id && this.pageItems) {\n        //    this.pageItems[event.id as any].setPopupAction(event.action, event.opt);\n        //}\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
